<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Campaign Post - Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .content {
            padding: 40px;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-bottom: 30px;
            border-radius: 4px;
        }

        .info-box strong {
            display: block;
            margin-bottom: 5px;
            color: #1976D2;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        label .required {
            color: #f44336;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        small {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 12px;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .campaign-option {
            padding: 10px;
        }

        .success-message {
            background: #4CAF50;
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
            animation: slideDown 0.3s ease;
        }

        .error-message {
            background: #f44336;
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .config-section {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .config-section strong {
            color: #856404;
            display: block;
            margin-bottom: 10px;
        }

        .config-input {
            margin-bottom: 10px;
        }

        .config-input label {
            font-weight: normal;
            font-size: 12px;
            margin-bottom: 3px;
        }

        .config-input input {
            padding: 8px 10px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>?? Create Campaign Post</h1>
            <p>Schedule and publish posts to your social media campaigns</p>
        </div>

        <div class="content">
            <!-- Configuration Section -->
            <div class="config-section">
                <strong>?? Configuration (Update These First)</strong>
                <div class="config-input">
                    <label>API Base URL</label>
                    <input type="text" id="apiBaseUrl" value="https://localhost:5001/api">
                </div>
                <div class="config-input">
                    <label>JWT Token (from login)</label>
                    <input type="text" id="jwtToken" placeholder="YOUR_JWT_TOKEN_HERE">
                </div>
                <div class="config-input">
                    <label>Store ID (GUID)</label>
                    <input type="text" id="storeId" placeholder="YOUR_STORE_ID_HERE">
                </div>
            </div>

            <!-- Info Box -->
            <div class="info-box">
                <strong>? New Features:</strong>
                <ul style="margin-left: 20px; margin-top: 5px;">
                    <li>DateTime now shows as "Dec 20, 2024 2:30 PM" (easy to read!)</li>
                    <li>Lightweight campaigns dropdown for better performance</li>
                    <li>Campaign selection includes stage and creation date</li>
                </ul>
            </div>

            <!-- Success Message -->
            <div class="success-message" id="successMessage"></div>

            <!-- Error Message -->
            <div class="error-message" id="errorMessage"></div>

            <!-- Form -->
            <form id="createPostForm">
                <!-- Campaign Dropdown -->
                <div class="form-group">
                    <label for="campaignDropdown">
                        Select Campaign <span class="required">*</span>
                    </label>
                    <select id="campaignDropdown" required>
                        <option value="">-- Loading campaigns... --</option>
                    </select>
                    <small>Choose the campaign this post belongs to</small>
                </div>

                <!-- Post Caption -->
                <div class="form-group">
                    <label for="postCaption">
                        Post Caption <span class="required">*</span>
                    </label>
                    <textarea 
                        id="postCaption" 
                        required 
                        maxlength="5000" 
                        placeholder="Write your post caption here... &#10;&#10;Example:&#10;?? Exciting news! Our Spring Sale is now live! &#10;Get 30% off all products. Limited time offer! ???"
                    ></textarea>
                    <small>Maximum 5000 characters</small>
                </div>

                <!-- Image URL -->
                <div class="form-group">
                    <label for="imageUrl">
                        Image URL (optional)
                    </label>
                    <input 
                        type="url" 
                        id="imageUrl" 
                        maxlength="500"
                        placeholder="https://example.com/images/product.jpg">
                    <small>Provide a direct URL to your post image</small>
                </div>

                <!-- Schedule Time -->
                <div class="form-group">
                    <label for="scheduledAt">
                        Schedule Date & Time (optional)
                    </label>
                    <input type="datetime-local" id="scheduledAt">
                    <small>Leave empty to publish immediately. API will return time in readable format (e.g., "Dec 25, 2024 10:00 AM")</small>
                </div>

                <button type="submit" class="btn" id="submitBtn">
                    ?? Create Campaign Post
                </button>
            </form>
        </div>
    </div>

    <script>
        let API_BASE = 'https://localhost:5001/api';
        let TOKEN = '';
        let STORE_ID = '';

        // Update configuration when inputs change
        document.getElementById('apiBaseUrl').addEventListener('change', (e) => {
            API_BASE = e.target.value.replace(/\/+$/, ''); // Remove trailing slash
            console.log('API Base updated:', API_BASE);
        });

        document.getElementById('jwtToken').addEventListener('change', (e) => {
            TOKEN = e.target.value.trim();
            if (TOKEN) {
                loadCampaigns();
            }
        });

        document.getElementById('storeId').addEventListener('change', (e) => {
            STORE_ID = e.target.value.trim();
            if (STORE_ID && TOKEN) {
                loadCampaigns();
            }
        });

        // Show message functions
        function showSuccess(message) {
            const el = document.getElementById('successMessage');
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => {
                el.style.display = 'none';
            }, 5000);
        }

        function showError(message) {
            const el = document.getElementById('errorMessage');
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => {
                el.style.display = 'none';
            }, 5000);
        }

        // Load campaigns for dropdown
        async function loadCampaigns() {
            if (!TOKEN || !STORE_ID) {
                console.log('?? Please configure JWT Token and Store ID first');
                return;
            }

            const dropdown = document.getElementById('campaignDropdown');
            dropdown.innerHTML = '<option value="">-- Loading campaigns... --</option>';

            try {
                const response = await fetch(`${API_BASE}/campaigns`, {
                    headers: {
                        'Authorization': `Bearer ${TOKEN}`,
                        'X-Store-ID': STORE_ID
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const campaigns = await response.json();
                
                // Clear loading option
                dropdown.innerHTML = '<option value="">-- Choose Campaign --</option>';

                if (campaigns.length === 0) {
                    dropdown.innerHTML = '<option value="">-- No campaigns found (create one first) --</option>';
                    console.log('?? No campaigns found for this store');
                    return;
                }

                // Populate dropdown with full campaign data
                campaigns.forEach(campaign => {
                    const option = document.createElement('option');
                    option.value = campaign.id;
                    option.textContent = `${campaign.campaignName} (${campaign.campaignStage}) - ${campaign.createdAt}`;
                    dropdown.appendChild(option);
                });

                console.log('? Campaigns loaded:', campaigns);
                showSuccess(`${campaigns.length} campaign(s) loaded successfully!`);
            } catch (error) {
                console.error('? Failed to load campaigns:', error);
                dropdown.innerHTML = '<option value="">-- Failed to load (check console) --</option>';
                showError(`Failed to load campaigns: ${error.message}`);
            }
        }

        // Handle form submission
        document.getElementById('createPostForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!TOKEN || !STORE_ID) {
                showError('?? Please configure JWT Token and Store ID first!');
                return;
            }

            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = '? Creating post...';
            submitBtn.disabled = true;

            const payload = {
                campaignId: document.getElementById('campaignDropdown').value,
                postCaption: document.getElementById('postCaption').value,
                postImageUrl: document.getElementById('imageUrl').value || null,
                scheduledAt: document.getElementById('scheduledAt').value || null
            };

            try {
                const response = await fetch(`${API_BASE}/campaign-posts`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${TOKEN}`,
                        'X-Store-ID': STORE_ID,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (response.ok) {
                    showSuccess(
                        `? Post created successfully!\n\n` +
                        `Campaign: ${result.campaignName}\n` +
                        `Scheduled: ${result.scheduledAt || 'Immediate'}\n` +
                        `Created: ${result.createdAt}`
                    );
                    
                    console.log('? Post created:', result);
                    
                    // Clear form
                    document.getElementById('createPostForm').reset();
                } else {
                    showError(`? Error: ${result.message || JSON.stringify(result)}`);
                    console.error('? API Error:', result);
                }
            } catch (error) {
                showError(`? Failed to create post: ${error.message}`);
                console.error('? Network Error:', error);
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });

        // Initial message
        console.log(`
?????????????????????????????????????????????
?   Campaign Post Creation Demo Page        ?
?   ? DateTime Format: Readable AM/PM      ?
?   ? Dropdown: Lightweight & Fast         ?
?   ? UX: Improved for clients             ?
?????????????????????????????????????????????

?? Instructions:
1. Update API Base URL (if different)
2. Enter your JWT Token (from login)
3. Enter your Store ID (GUID)
4. Click outside the input fields to load campaigns
5. Fill the form and create your post!

Note: Check browser console for detailed logs
        `);
    </script>
</body>
</html>
