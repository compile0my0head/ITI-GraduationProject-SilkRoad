<div class="dashboard">
  <!-- Error Alert -->
  @if (error()) {
    <div class="alert alert-error" (click)="clearError()">
      <span>{{ error() }}</span>
      <button class="close-btn">&times;</button>
    </div>
  }

  <!-- Page Header -->
  <div class="page-header">
    <div>
      <h1>Dashboard</h1>
      @if (currentStore()) {
        <p class="subtitle">Welcome to {{ currentStore()!.storeName }}</p>
      }
    </div>
    <div class="header-actions">
      <a routerLink="/app/orders" class="btn btn-primary">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"/>
          <line x1="5" y1="12" x2="19" y2="12"/>
        </svg>
        New Order
      </a>
    </div>
  </div>

  @if (isLoading()) {
    <div class="loading-container">
      <div class="spinner-large"></div>
      <p>Loading dashboard...</p>
    </div>
  } @else {
    <!-- Stats Cards -->
    @if (stats()) {
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon products">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83 0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/>
              <line x1="7" y1="7" x2="7.01" y2="7"/>
            </svg>
          </div>
          <div class="stat-content">
            <span class="stat-value">{{ stats()!.totalProducts }}</span>
            <span class="stat-label">Products</span>
          </div>
          <a routerLink="/app/products" class="stat-link">View all</a>
        </div>

        <div class="stat-card">
          <div class="stat-icon customers">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
              <circle cx="9" cy="7" r="4"/>
              <path d="M23 21v-2a4 4 0 00-3-3.87"/>
              <path d="M16 3.13a4 4 0 010 7.75"/>
            </svg>
          </div>
          <div class="stat-content">
            <span class="stat-value">{{ stats()!.totalCustomers }}</span>
            <span class="stat-label">Customers</span>
          </div>
          <a routerLink="/app/customers" class="stat-link">View all</a>
        </div>

        <div class="stat-card">
          <div class="stat-icon orders">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
              <line x1="3" y1="6" x2="21" y2="6"/>
              <path d="M16 10a4 4 0 01-8 0"/>
            </svg>
          </div>
          <div class="stat-content">
            <span class="stat-value">{{ stats()!.totalOrders }}</span>
            <span class="stat-label">Total Orders</span>
          </div>
          <a routerLink="/app/orders" class="stat-link">View all</a>
        </div>

        <div class="stat-card highlight">
          <div class="stat-icon pending">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <polyline points="12 6 12 12 16 14"/>
            </svg>
          </div>
          <div class="stat-content">
            <span class="stat-value">{{ stats()!.pendingOrders }}</span>
            <span class="stat-label">Pending Orders</span>
          </div>
          <a routerLink="/app/orders" [queryParams]="{status: 'Pending'}" class="stat-link">Review</a>
        </div>

        <div class="stat-card">
          <div class="stat-icon campaigns">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
            </svg>
          </div>
          <div class="stat-content">
            <span class="stat-value">{{ stats()!.activeCampaigns }}</span>
            <span class="stat-label">Active Campaigns</span>
          </div>
          <a routerLink="/app/campaigns" class="stat-link">View all</a>
        </div>

        <div class="stat-card">
          <div class="stat-icon revenue">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="1" x2="12" y2="23"/>
              <path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/>
            </svg>
          </div>
          <div class="stat-content">
            <span class="stat-value">${{ stats()!.revenue.toLocaleString() }}</span>
            <span class="stat-label">Revenue</span>
          </div>
        </div>
      </div>
    }

    <!-- Pending Orders Section -->
    <div class="section">
      <div class="section-header">
        <h2>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12 6 12 12 16 14"/>
          </svg>
          Pending Orders
        </h2>
        <a routerLink="/app/orders" [queryParams]="{status: 'Pending'}" class="btn btn-ghost">View All</a>
      </div>

      @if (hasPendingOrders()) {
        <div class="orders-list">
          @for (order of pendingOrders().slice(0, 5); track order.id) {
            <div class="order-card">
              <div class="order-info">
                <div class="order-id">#{{ order.id.slice(0, 8) }}</div>
                <div class="order-customer">{{ order.customerName || order.customer?.customerName || 'Unknown Customer' }}</div>
                <div class="order-amount">${{ order.totalPrice.toFixed(2) }}</div>
                <div class="order-date">{{ order.createdAt | date:'short' }}</div>
              </div>
              <div class="order-actions">
                <a [routerLink]="['/app/orders', order.id]" class="btn btn-secondary btn-sm" title="View Details">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                    <circle cx="12" cy="12" r="3"/>
                  </svg>
                  View
                </a>
                <button class="btn btn-success btn-sm" (click)="acceptOrder(order)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"/>
                  </svg>
                  Accept
                </button>
                <button class="btn btn-danger btn-sm" (click)="rejectOrder(order)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                  </svg>
                  Reject
                </button>
              </div>
            </div>
          }
        </div>
      } @else {
        <div class="empty-state">
          <div class="empty-icon">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <polyline points="20 6 9 17 4 12"/>
            </svg>
          </div>
          <p>No pending orders! You're all caught up.</p>
        </div>
      }
    </div>

    <!-- Quick Actions -->
    <div class="section">
      <div class="section-header">
        <h2>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
          </svg>
          Quick Actions
        </h2>
      </div>
      <div class="quick-actions-grid">
        <a routerLink="/app/products/add" class="quick-action-card">
          <div class="action-icon products">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"/>
              <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
          </div>
          <span>Add Product</span>
        </a>
        <a routerLink="/app/customers/add" class="quick-action-card">
          <div class="action-icon customers">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
              <circle cx="8.5" cy="7" r="4"/>
              <line x1="20" y1="8" x2="20" y2="14"/>
              <line x1="23" y1="11" x2="17" y2="11"/>
            </svg>
          </div>
          <span>Add Customer</span>
        </a>
        <a routerLink="/app/campaigns/create" class="quick-action-card">
          <div class="action-icon campaigns">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
            </svg>
          </div>
          <span>Create Campaign</span>
        </a>
        <a routerLink="/app/orders" class="quick-action-card">
          <div class="action-icon orders">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
              <line x1="3" y1="6" x2="21" y2="6"/>
              <path d="M16 10a4 4 0 01-8 0"/>
            </svg>
          </div>
          <span>New Order</span>
        </a>
      </div>
    </div>
  }
</div>
