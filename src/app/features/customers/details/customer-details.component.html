<div class="customer-details">
  <!-- Loading State -->
  @if (isLoading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Loading customer details...</p>
    </div>
  }

  <!-- Error State -->
  @if (error() && !isLoading()) {
    <div class="error-state">
      <div class="alert alert-error" (click)="clearError()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <span>{{ error() }}</span>
        <button class="close-btn">&times;</button>
      </div>
      <button class="btn btn-secondary" (click)="goBack()">Back to Customers</button>
    </div>
  }

  <!-- Customer Content -->
  @if (customer() && !isLoading()) {
    <!-- Page Header -->
    <div class="page-header">
      <div class="header-back">
        <button class="back-link" (click)="goBack()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="19" y1="12" x2="5" y2="12"/>
            <polyline points="12 19 5 12 12 5"/>
          </svg>
          Back to Customers
        </button>
      </div>
      <h1>Customer Details</h1>
    </div>

    <div class="customer-content">
      <!-- Customer Information Card -->
      <div class="section-card customer-info-card">
        <div class="card-header">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/>
            <circle cx="12" cy="7" r="4"/>
          </svg>
          <h2>Customer Information</h2>
        </div>
        <div class="customer-details-grid">
          <div class="detail-item">
            <span class="detail-label">Name</span>
            <span class="detail-value">{{ customer()!.customerName }}</span>
          </div>
          @if (customer()!.phone) {
            <div class="detail-item">
              <span class="detail-label">Phone</span>
              <span class="detail-value">{{ customer()!.phone }}</span>
            </div>
          }
          @if (customer()!.billingAddress) {
            <div class="detail-item">
              <span class="detail-label">Address</span>
              <span class="detail-value">{{ customer()!.billingAddress }}</span>
            </div>
          }
          @if (customer()!.psid) {
            <div class="detail-item">
              <span class="detail-label">Facebook PSID</span>
              <span class="detail-value detail-value-small">{{ customer()!.psid }}</span>
            </div>
          }
          <div class="detail-item">
            <span class="detail-label">Customer Since</span>
            <span class="detail-value">{{ formatDate(customer()!.createdAt) }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Customer ID</span>
            <span class="detail-value detail-value-small">{{ customer()!.id }}</span>
          </div>
        </div>
        <div class="card-actions">
          <a [routerLink]="['/app/customers/edit', customer()!.id]" class="btn btn-secondary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
              <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
            Edit Customer
          </a>
        </div>
      </div>

      <!-- Order Statistics Card -->
      <div class="section-card stats-card">
        <div class="card-header">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/>
          </svg>
          <h2>Order Statistics</h2>
        </div>
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-value">{{ customerOrders().length }}</span>
            <span class="stat-label">Total Orders</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">{{ formatCurrency(totalOrderValue()) }}</span>
            <span class="stat-label">Total Value</span>
          </div>
        </div>
      </div>

      <!-- Order History Card -->
      <div class="section-card orders-card">
        <div class="card-header">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
            <line x1="3" y1="6" x2="21" y2="6"/>
            <path d="M16 10a4 4 0 01-8 0"/>
          </svg>
          <h2>Order History</h2>
        </div>

        @if (isLoadingOrders()) {
          <div class="orders-loading">
            <div class="spinner"></div>
            <p>Loading orders...</p>
          </div>
        } @else if (!hasOrders()) {
          <div class="empty-state">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
              <line x1="3" y1="6" x2="21" y2="6"/>
            </svg>
            <h3>No Orders Yet</h3>
            <p>This customer hasn't placed any orders yet.</p>
          </div>
        } @else {
          <div class="orders-list">
            @for (order of customerOrders(); track order.id) {
              <div class="order-item" (click)="navigateToOrder(order.id)">
                <div class="order-info">
                  <div class="order-header">
                    <span class="order-id">#{{ order.id.slice(0, 8) }}</span>
                    <span class="status-badge" [class]="getStatusClass(order.status)">
                      {{ getStatusIcon(order.status) }} {{ order.status }}
                    </span>
                  </div>
                  <div class="order-meta">
                    <span class="order-date">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12 6 12 12 16 14"/>
                      </svg>
                      {{ formatDate(order.createdAt) }}
                    </span>
                    @if (order.orderSource) {
                      <span class="order-source">
                        {{ order.orderSource }}
                      </span>
                    }
                  </div>
                </div>
                <div class="order-amount">
                  {{ formatCurrency(order.totalPrice) }}
                </div>
                <svg class="chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="9 18 15 12 9 6"/>
                </svg>
              </div>
            }
          </div>
        }
      </div>
    </div>
  }
</div>
