<div class="page-container">
  <!-- Error Alert -->
  @if (error()) {
    <div class="alert alert-error" (click)="clearError()">
      <span>{{ error() }}</span>
      <button class="close-btn">&times;</button>
    </div>
  }

  <!-- Page Header -->
  <div class="page-header">
    <div>
      <h1>Customers</h1>
      <p class="subtitle">Manage your customer database</p>
    </div>
    <a routerLink="/app/customers/add" class="btn btn-primary">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="12" y1="5" x2="12" y2="19"/>
        <line x1="5" y1="12" x2="19" y2="12"/>
      </svg>
      Add Customer
    </a>
  </div>

  <!-- Search Bar -->
  <div class="search-bar">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="11" cy="11" r="8"/>
      <line x1="21" y1="21" x2="16.65" y2="16.65"/>
    </svg>
    <input 
      type="text" 
      placeholder="Search by name, email or phone..."
      [value]="searchQuery()"
      (input)="searchQuery.set($any($event.target).value)"
    />
  </div>

  @if (isLoading()) {
    <div class="loading-container">
      <div class="spinner-large"></div>
      <p>Loading customers...</p>
    </div>
  } @else if (!hasCustomers()) {
    <div class="empty-state">
      <div class="empty-icon">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
          <circle cx="9" cy="7" r="4"/>
          <path d="M23 21v-2a4 4 0 00-3-3.87"/>
          <path d="M16 3.13a4 4 0 010 7.75"/>
        </svg>
      </div>
      <h2>No Customers Yet</h2>
      <p>Start building your customer base by adding your first customer.</p>
      <a routerLink="/app/customers/add" class="btn btn-primary btn-lg">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"/>
          <line x1="5" y1="12" x2="19" y2="12"/>
        </svg>
        Add Your First Customer
      </a>
    </div>
  } @else {
    <!-- Customers Grid -->
    <div class="customers-grid">
      @for (customer of filteredCustomers(); track customer.id) {
        <div class="customer-card">
          <div class="customer-avatar">
            {{ customer.customerName.charAt(0).toUpperCase() }}
          </div>
          <div class="customer-content">
            <h3>{{ customer.customerName }}</h3>
            <div class="customer-details">
              @if (customer.phone) {
                <div class="detail-item">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"/>
                  </svg>
                  <span>{{ customer.phone }}</span>
                </div>
              }
              @if (customer.billingAddress) {
                <div class="detail-item">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/>
                    <circle cx="12" cy="10" r="3"/>
                  </svg>
                  <span>{{ customer.billingAddress }}</span>
                </div>
              }
            </div>
            <div class="customer-actions">
              <a [routerLink]="['/app/customers/edit', customer.id]" class="btn btn-secondary btn-sm">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                  <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
                </svg>
                Edit
              </a>
              <button class="btn btn-danger btn-sm" (click)="openDeleteModal(customer)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"/>
                  <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                </svg>
                Delete
              </button>
            </div>
          </div>
        </div>
      }
    </div>

    @if (filteredCustomers().length === 0 && searchQuery()) {
      <div class="no-results">
        <p>No customers found matching "{{ searchQuery() }}"</p>
      </div>
    }
  }
</div>

<!-- Delete Confirmation Modal -->
@if (showDeleteModal()) {
  <div class="modal-overlay" (click)="closeDeleteModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Delete Customer</h2>
        <button class="close-btn" (click)="closeDeleteModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete <strong>{{ customerToDelete()?.customerName }}</strong>?</p>
        <p class="warning-text">This action cannot be undone. All associated orders will be affected.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeDeleteModal()">Cancel</button>
        <button class="btn btn-danger" (click)="confirmDelete()" [disabled]="isLoading()">
          @if (isLoading()) {
            <span class="spinner"></span>
            Deleting...
          } @else {
            Delete Customer
          }
        </button>
      </div>
    </div>
  </div>
}
