<div class="edit-customer">
  <!-- Loading State -->
  @if (isLoading()) {
    <div class="loading-container">
      <div class="spinner-large"></div>
      <p>Loading customer...</p>
    </div>
  } @else {
    <!-- Header -->
    <div class="page-header">
      <a routerLink="/app/customers" class="back-link">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="19" y1="12" x2="5" y2="12"/>
          <polyline points="12 19 5 12 12 5"/>
        </svg>
        Back to Customers
      </a>
      <h1>Edit Customer</h1>
      <p class="subtitle">Update customer information</p>
    </div>

    <!-- Error Message -->
    @if (error()) {
      <div class="error-message">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <span>{{ error() }}</span>
      </div>
    }

    <!-- Form Card -->
    <div class="form-card">
      <form (ngSubmit)="submitForm()" [class.shake]="formSubmitAttempted() && !isFormValid()">
        <div class="form-section">
          <h3>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
            Customer Information
          </h3>
          
          <div class="form-grid">
            <div class="form-group full-width" [class.has-error]="showNameError()">
              <label for="name">
                Full Name
                <span class="required-indicator">*</span>
              </label>
              <div class="input-wrapper" [class.has-error]="showNameError()">
                <input 
                  type="text" 
                  id="name" 
                  class="form-control"
                  [class.input-error]="showNameError()"
                  [class.input-success]="nameTouched() && nameValidation().valid && name()"
                  [ngModel]="name()"
                  (ngModelChange)="name.set($event)"
                  (blur)="onNameBlur()"
                  name="name"
                  placeholder="Enter customer's full name"
                />
                @if (nameTouched() && name()) {
                  <span class="status-icon" [class.success]="nameValidation().valid" [class.error]="!nameValidation().valid">
                    @if (nameValidation().valid) {
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"/>
                      </svg>
                    } @else {
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="12"/>
                        <line x1="12" y1="16" x2="12.01" y2="16"/>
                      </svg>
                    }
                  </span>
                }
              </div>
              @if (showNameError()) {
                <div class="field-error">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                  </svg>
                  <span>{{ nameValidation().message }}</span>
                </div>
              }
            </div>

            <div class="form-group" [class.has-error]="showPhoneError()">
              <label for="phone">Phone Number</label>
              <div class="input-wrapper" [class.has-error]="showPhoneError()">
                <input 
                  type="tel" 
                  id="phone" 
                  class="form-control"
                  [class.input-error]="showPhoneError()"
                  [class.input-success]="phoneTouched() && phoneValidation().valid && phone()"
                  [ngModel]="phone()"
                  (ngModelChange)="phone.set($event)"
                  (blur)="onPhoneBlur()"
                  name="phone"
                  placeholder="+1 (555) 123-4567"
                />
                @if (phoneTouched() && phone()) {
                  <span class="status-icon" [class.success]="phoneValidation().valid" [class.error]="!phoneValidation().valid">
                    @if (phoneValidation().valid) {
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"/>
                      </svg>
                    } @else {
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="12"/>
                        <line x1="12" y1="16" x2="12.01" y2="16"/>
                      </svg>
                    }
                  </span>
                }
              </div>
              @if (showPhoneError()) {
                <div class="field-error">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                  </svg>
                  <span>{{ phoneValidation().message }}</span>
                </div>
              }
            </div>

            <div class="form-group">
              <label for="address">Billing Address</label>
              <textarea 
                id="address" 
                class="form-control"
                [ngModel]="address()"
                (ngModelChange)="address.set($event)"
                name="address"
                placeholder="Enter billing address"
                rows="3"
              ></textarea>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="cancel()">
            Cancel
          </button>
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="!isFormValid() || isSubmitting()"
          >
            @if (isSubmitting()) {
              <span class="spinner"></span>
              Saving...
            } @else {
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
              Save Changes
            }
          </button>
        </div>
      </form>
    </div>
  }
</div>
