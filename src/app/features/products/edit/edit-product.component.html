<div class="page-container">
  <!-- Success Alert -->
  @if (success()) {
    <div class="alert alert-success">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
        <polyline points="22 4 12 14.01 9 11.01"/>
      </svg>
      <span>{{ success() }}</span>
    </div>
  }

  <!-- Error Alert -->
  @if (error()) {
    <div class="alert alert-error" (click)="clearError()">
      <span>{{ error() }}</span>
      <button class="close-btn">&times;</button>
    </div>
  }

  <!-- Page Header -->
  <div class="page-header">
    <div class="header-back">
      <a routerLink="/app/products" class="back-link">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="19" y1="12" x2="5" y2="12"/>
          <polyline points="12 19 5 12 12 5"/>
        </svg>
        Back to Products
      </a>
    </div>
    <h1>Edit Product</h1>
    @if (selectedProduct()) {
      <p class="subtitle">Editing: {{ selectedProduct()!.productName }}</p>
    }
  </div>

  @if (isLoading() && !selectedProduct()) {
    <div class="loading-container">
      <div class="spinner-large"></div>
      <p>Loading product...</p>
    </div>
  } @else if (selectedProduct()) {
    <!-- Form Card -->
    <div class="form-card">
      <form (ngSubmit)="onSubmit()">
        <div class="form-grid">
          <!-- Product Name -->
          <div class="form-group full-width" [class.has-error]="showNameError()">
            <label for="name">
              Product Name
              <span class="required-indicator">*</span>
            </label>
            <div class="input-wrapper" [class.has-error]="showNameError()">
              <input
                type="text"
                id="name"
                class="form-control"
                [class.input-error]="showNameError()"
                [class.input-success]="nameTouched() && nameValidation().valid && name()"
                [value]="name()"
                (input)="name.set($any($event.target).value)"
                (blur)="onNameBlur()"
                placeholder="Enter product name"
                required
              />
              @if (nameTouched() && name()) {
                <span class="status-icon" [class.success]="nameValidation().valid" [class.error]="!nameValidation().valid">
                  @if (nameValidation().valid) {
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="20 6 9 17 4 12"/>
                    </svg>
                  } @else {
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <line x1="12" y1="8" x2="12" y2="12"/>
                      <line x1="12" y1="16" x2="12.01" y2="16"/>
                    </svg>
                  }
                </span>
              }
            </div>
            @if (showNameError()) {
              <div class="field-error">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="12" y1="8" x2="12" y2="12"/>
                  <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                <span>{{ nameValidation().message }}</span>
              </div>
            }
          </div>

          <!-- Description -->
          <div class="form-group full-width">
            <label for="description">Description</label>
            <textarea
              id="description"
              class="form-control"
              [value]="description()"
              (input)="description.set($any($event.target).value)"
              placeholder="Enter product description"
              rows="4"
            ></textarea>
          </div>

          <!-- Price -->
          <div class="form-group" [class.has-error]="showPriceError()">
            <label for="price">
              Price ($)
              <span class="required-indicator">*</span>
            </label>
            <div class="input-wrapper" [class.has-error]="showPriceError()">
              <input
                type="number"
                id="price"
                class="form-control"
                [class.input-error]="showPriceError()"
                [class.input-success]="priceTouched() && priceValidation().valid && price() !== null"
                [value]="price()"
                (input)="price.set($any($event.target).valueAsNumber)"
                (blur)="onPriceBlur()"
                placeholder="0.00"
                min="0"
                step="0.01"
                required
              />
              @if (priceTouched() && price() !== null) {
                <span class="status-icon" [class.success]="priceValidation().valid" [class.error]="!priceValidation().valid">
                  @if (priceValidation().valid) {
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="20 6 9 17 4 12"/>
                    </svg>
                  } @else {
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <line x1="12" y1="8" x2="12" y2="12"/>
                      <line x1="12" y1="16" x2="12.01" y2="16"/>
                    </svg>
                  }
                </span>
              }
            </div>
            @if (showPriceError()) {
              <div class="field-error">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="12" y1="8" x2="12" y2="12"/>
                  <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                <span>{{ priceValidation().message }}</span>
              </div>
            }
          </div>

          <!-- Stock Quantity -->
          <div class="form-group" [class.has-error]="showStockQuantityError()">
            <label for="stockQuantity">
              Stock Quantity
              <span class="required-indicator">*</span>
            </label>
            <div class="input-wrapper" [class.has-error]="showStockQuantityError()">
              <input
                type="number"
                id="stockQuantity"
                class="form-control"
                [class.input-error]="showStockQuantityError()"
                [class.input-success]="stockQuantityTouched() && stockQuantityValidation().valid && stockQuantity() !== null"
                [value]="stockQuantity()"
                (input)="stockQuantity.set($any($event.target).valueAsNumber)"
                (blur)="onStockQuantityBlur()"
                placeholder="0"
                min="0"
                required
              />
              @if (stockQuantityTouched() && stockQuantity() !== null) {
                <span class="status-icon" [class.success]="stockQuantityValidation().valid" [class.error]="!stockQuantityValidation().valid">
                  @if (stockQuantityValidation().valid) {
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="20 6 9 17 4 12"/>
                    </svg>
                  } @else {
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <line x1="12" y1="8" x2="12" y2="12"/>
                      <line x1="12" y1="16" x2="12.01" y2="16"/>
                    </svg>
                  }
                </span>
              }
            </div>
            @if (showStockQuantityError()) {
              <div class="field-error">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="12" y1="8" x2="12" y2="12"/>
                  <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                <span>{{ stockQuantityValidation().message }}</span>
              </div>
            }
          </div>

          <!-- Category -->
          <div class="form-group">
            <label for="category">Category</label>
            <input
              type="text"
              id="category"
              class="form-control"
              [value]="category()"
              (input)="category.set($any($event.target).value)"
              placeholder="e.g., Electronics, Clothing"
            />
          </div>

          <!-- Image URL -->
          <div class="form-group">
            <label for="imageUrl">Image URL</label>
            <input
              type="url"
              id="imageUrl"
              class="form-control"
              [value]="imageUrl()"
              (input)="imageUrl.set($any($event.target).value)"
              placeholder="https://example.com/image.jpg"
            />
          </div>
        </div>

        <!-- Image Preview -->
        @if (imageUrl()) {
          <div class="image-preview">
            <label>Image Preview</label>
            <div class="preview-container">
              <img [src]="imageUrl()" alt="Product preview" />
            </div>
          </div>
        }

        <!-- Form Actions -->
        <div class="form-actions">
          <a routerLink="/app/products" class="btn btn-secondary">Cancel</a>
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="!isFormValid() || isLoading()"
          >
            @if (isLoading()) {
              <span class="spinner"></span>
              Saving...
            } @else {
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
                <polyline points="17 21 17 13 7 13 7 21"/>
                <polyline points="7 3 7 8 15 8"/>
              </svg>
              Save Changes
            }
          </button>
        </div>
      </form>
    </div>
  }
</div>
